<%= render "homes/sidebar" %>

<div class="container-fluid">
  <div class="row">

    <div class="col-2 col-md-1" style="height: 1px;"></div>
    <div class="col-10 col-md-11 my-2 mx-auto">

      <h3>地図検索</h3>
        <div class="border my-2" id="map"></div>
        <style>
          #map {
            width: 100%;
            height: 500px;
          }
        </style>
        <script>
          // import { MarkerClusterer } from "@googlemaps/markerclusterer";
          var map;
          var marker = [];
          var infoWindow = [];
          var markersData = [
            // {
            //       name: 'TAM 東京',
            //       lat: 35.6954806,
            //         lng: 139.76325010000005,
            //         icon: 'tam.png' // TAM 東京のマーカーだけイメージを変更する
            // }, {
            //         name: '小川町駅',
            //     lat: 35.6951212,
            //         lng: 139.76610649999998
            // }, {
            //         name: '淡路町駅',
            //     lat: 35.69496,
            //       lng: 139.76746000000003
            // }, {
            //         name: '御茶ノ水駅',
            //         lat: 35.6993529,
            //         lng: 139.76526949999993
            // }, {
            //         name: '%= link_to root_path do %>神保町駅% end %>',
            //     lat: 35.695932,
            //     lng: 139.75762699999996
            // }, {
            //         name: '新御茶ノ水駅',
            //       lat: 35.696932,
            //     lng: 139.76543200000003
            // }
            <% @posts.each do |post| %>
              {
                name: '<%= post.title %>'
                lat: '<%= post.lat %>'
                lng: '<%= post.lng %>'
              },
            <% end %>
          ];
          function initMap(){
            // var mapLatLng = new google.maps.LatLng({lat: markerData[0]['lat'], lng: markerData[0]['lng']});
            map = new google.maps.Map(document.getElementById("map"), {
              zoom: 6,
              center:  {lat: 35.6803997, lng:139.7690174},  //東京
            });

            for (var i = 0; i < markersData.length; i++ ){
              markerLatLng = new google.maps.LatLng({lat: markersData[i]['lat'], lng: markersData[i]['lng']});
              marker[i] = new google.maps.Marker({
                position: markerLatLng,
                map: map
              });
              infoWindow[i] = new google.maps.InfoWindow({
                content: markersData[i]['name'],
                disableAutoPan: true
              });
              markerEvent(i);
            }
          }

          function markerEvent(i){
            marker[i].addListener('click', function(){
              infoWindow[i].open(map, marker[i]);
            });
          }

        </script>
        <!--ピンのクラスター化-->
        <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=<%=ENV["GOOGLE_MAP_KEY"]%>&callback=initMap" async defer></script>


      <h3>キーワード検索</h3>
      <div class="container-fluid m-2 ">
        <%= render 'search', q: @q, url: search_index_posts_path %>
      </div>
    </div>

  </div>
</div>

<% if @check.present? %>
  <div class="container-fluid">
    <%= render "posts/post_lists", posts: @results, title:"検索結果" %>
  </div>
<% end %>
