<%= render "homes/sidebar" %>

<div class="container-fluid">
  <div class="row">

    <div class="col-1" style="height: 1px;"></div>
    <div class="col-11 my-2 mr-auto">
      <h3><strong>『<%= @post.title %>』</strong></h3>
      <div class="row border m-2 p-2 bg-light">

        <div class="col-8">
          <div>
            <%= attachment_image_tag @post, :image, fallback: "no_image.jpg", class:"mx-auto border post_or_user_image" %>
          </div>
          <div class="fontawesomes">
            <strong>
              <span id="favorite_buttons_<%= @post.id %>">
                <%= render "favorites/favorite", post: @post %>
              </span>
              <span>
                <i class="far fa-eye ml-3"></i><%= @post.impressions_counts.count %>
              </span>
              <span>
                <i class="far fa-comments ml-3"></i><%= @post.comments.count %>
              </span>
            </strong>
            <span>
              <i class="fas fa-clock ml-3"></i>(<%= @post.created_at.strftime('%Y/%m/%d %H:%M') %>)
            </span>
            <div id="star-rate-<%= @post.id %>"></div>
            <script>
              $('#star-rate-<%= @post.id %>').empty();
              $('#star-rate-<%= @post.id %>').raty({
                size: 36,
                starOff:  '<%= asset_path('star-off.png') %>',
                starOn : '<%= asset_path('star-on.png') %>',
                starHalf: '<%= asset_path('star-half.png') %>',
                half: true,
                readOnly: true,
                score: <%= @post.rate %>,
              });
            </script>
          </div>
        </div>
        <div class="col-4">
          <%= link_to user_path(@post.user), 'data-turbolinks': false do %>
            <%= attachment_image_tag @post.user, :profile_image, fallback: "no_image.jpg", class:"post_or_user_image border" %>
            <strong class="text-dark">投稿</strong>
            <p class="text-dark"><%= @post.user.name %>さん</p>
          <% end %>
          <strong>場所</strong><br>
          <%= @post.post_prefecture %><br><br>
          <strong>おすすめポイント</strong><br>
          <%= @post.body %><br><br>
          <% if @post.user == current_user %>
            <%= link_to edit_post_path(@post), 'data-turbolinks': false, class:"btn btn-sm btn-outline-secondary" do %>
              <i class="fas fa-user-cog">投稿編集</i>
            <% end %>
          <% end %>
        </div>
      </div>

      <div class="row border mt-4 m-2 p-2 bg-light">
        <div class="col-8">
          <h3>ポイントの地図</h3>
          <div id='map'></div>
        </div>
      </div>

      <!--GoogleMap style/script-->

      <style>
        #map {
          height: 600px;
          width: 100%;
        }
      </style>

      <script>
      //初期マップの設定
      let map
      let marker
      function initMap(){
        geocoder = new google.maps.Geocoder()

        map = new google.maps.Map(document.getElementById('map'), {
          center:  {lat: <%= @post.lat %>, lng: <%= @post.lng %> },
          zoom: 13,
        });

        marker = new google.maps.Marker({ //GoogleMapにマーカーを落とす
          position: {lat: <%= @post.lat %>, lng: <%= @post.lng %> }, //マーカーを落とす位置を決める（値はDBに入っている）
          map: map //マーカーを落とすマップを指定
        });

      }
      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=<%=ENV["GOOGLE_MAP_KEY"]%>&callback=initMap" async defer></script>

      <div class="row border mt-4 m-2 p-2 bg-light">
        <div class="col-12 comment_area">
          <%= render "comments/comments", post: @post, comment: @comment %>
        </div>
      </div>



    </div>
  </div>
</div>
